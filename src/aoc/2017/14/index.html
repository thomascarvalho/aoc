<!DOCTYPE html>
<html><head><meta charset="UTF-8"><meta content="width=device-width, initial-scale=1" name="viewport"><meta content="First things first, let&apos;s load our input and parse it" property="og:description"><meta content="Problem" property="og:title"><meta content="article:clerk" property="og:type"><meta content="summary_large_image" name="twitter:card"><link href="./../../../../_data/8VwC6fDMy6vk5cFDRApNww7gzg5ZkHPof25FWfy2Xk5sXLC7Y5hcdUv8KhPr3oxgq3LKb4mNZWdWc4JtsXLkwHnmg1.css" rel="stylesheet" type="text/css"><script src="https://storage.clerk.garden/nextjournal/clerk-assets@43sknWSpfsWGp1HAfZe1dLuBjmWH/viewer.js?immutable=true" type="module"></script><link href="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/katex.min.css" rel="stylesheet" type="text/css"><link href="https://fonts.bunny.net" rel="preconnect"><link href="https://fonts.bunny.net/css?family=fira-mono:400,700%7Cfira-sans:400,400i,500,500i,700,700i%7Cfira-sans-condensed:700,700i%7Cpt-serif:400,400i,700,700i" rel="stylesheet" type="text/css"><style id="extra-styles">em {
  font-style: normal !important;
}

html:not(.dark) {
  background-color: #f4f3f3;
}

html.dark {
  background-color: #222831 !important;
}

body {
  background: transparent !important;
}

html:not(.dark) pre {
  background-color: #f1f5f9 !important;
  color: #7aaac4 !important;
}

.font-display {
  font-family: 'Fira Sans Condensed', sans-serif;
}

.dark em {
  color: #fff !important;
  text-shadow: 0 0 5px #fff !important;
}

.dark pre {
  background-color: rgb(31 41 55 / var(--tw-bg-opacity)) !important;
}

html:not(.dark) em {
  color: #000 !important;
  text-shadow: 0 0 2px #000 !important;
}

.viewer-result:first-child {
  display: none !important;
}

.notebook-viewer > pre > code {
  background: transparent !important;
}

.notebook-viewer
  :is(:where(code):not(:where([class~="not-prose"], [class~="not-prose"] *))),
.markdown-viewer
  :is(:where(code):not(:where([class~="not-prose"], [class~="not-prose"] *))) {
  background-color: transparent;
}
</style></head><body class="dark:bg-gray-900"><div id="clerk"></div><script type="module">let viewer = nextjournal.clerk.sci_env
let state = "{:bundle? false, :path->doc {\"src/aoc/2017/14\" {:path [], :nextjournal/value {:toc [{:title \"Problem\", :emoji nil, :path \"#problem\", :items []} {:title \"Solution\", :emoji nil, :path \"#solution\", :items [{:title \"Part 1\", :emoji nil, :path \"#part-1\", :items []} {:title \"Part 2\", :emoji nil, :path \"#part-2\", :items []}]} {:title \"Tests\", :emoji nil, :path \"#tests\", :items []}], :sidenotes? false, :toc-visibility true, :atom-var-name->state #viewer-eval (nextjournal.clerk.render/intern-atoms! {}), :ns #viewer-eval (ns aoc.2017.14), :file \"src/aoc/2017/14.clj\", :scope aoc.2017.14, :bundle? false, :header {:path [], :nextjournal/value [:div.viewer.w-full.max-w-prose.px-8.not-prose.mt-3 [:div.mb-8.text-xs.sans-serif.text-slate-400 nil [:<> [:a.font-medium.border-b.border-dotted.border-slate-300.hover:text-indigo-500.hover:border-indigo-500.dark:border-slate-500.dark:hover:text-white.dark:hover:border-white.transition {:href \"./../../../../\"} \"Index\"] [:span.mx-2 \"â€¢\"]] [:span \"Served from \" [:a.font-medium.border-b.border-dotted.border-slate-300.hover:text-indigo-500.hover:border-indigo-500.dark:border-slate-500.dark:hover:text-white.dark:hover:border-white.transition {:href \"https://clerk.vision\"} \"Clerk\"] nil]]], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-html, :hash \"5dtFMoRpfSur3BJ5RKN8sHB4mECYMZ\"}}, :open-graph {:type \"article:clerk\", :title \"Problem\", :description \"First things first, let's load our input and parse it\"}, :title \"Problem\", :blocks [{:path [], :nextjournal/value [:div.viewer.markdown-viewer.w-full.max-w-prose.px-8 {:data-block-id \"aoc.2017.14/markdown-5dqq5acBASUPKy7JX3Uoyxc1KPMN9A\"} [\"h1\" {:id \"problem\"} [:<> \"Problem\"]]], :nextjournal/render-opts {:id \"aoc.2017.14/markdown-5dqq5acBASUPKy7JX3Uoyxc1KPMN9A\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/markdown-node-viewer, :render-fn #viewer-fn identity, :hash \"5dsjzwxRkivFXiBf1NDMWmH54cVWV1\"}} {:path [], :nextjournal/value {:nextjournal/presented {:path [], :nextjournal/value [:div {:dangerouslySetInnerHTML {:__html \"<details><summary class=\\\"cursor-pointer\\\"><span class=\\\"text-xl font-bold\\\">Details</span></summary><article class=\\\"day-desc\\\"><h2>--- Day 14: Disk Defragmentation ---</h2><p>Suddenly, a scheduled job activates the system's <a href=\\\"https://en.wikipedia.org/wiki/Defragmentation\\\">disk defragmenter</a>. Were the situation different, you might <a href=\\\"https://www.youtube.com/watch?v=kPv1gQ5Rs8A&amp;t=37\\\">sit and watch it for a while</a>, but today, you just don't have that kind of time. It's soaking up valuable system resources that are needed elsewhere, and so the only option is to help it finish its task as soon as possible.</p>\\n<p>The disk in question consists of a 128x128 grid; each square of the grid is either <em>free</em> or <em>used</em>. On this disk, the state of the grid is tracked by the bits in a sequence of <a href=\\\"10\\\">knot hashes</a>.</p>\\n<p>A total of 128 knot hashes are calculated, each corresponding to a single row in the grid; each hash contains 128 bits which correspond to individual grid squares. Each bit of a hash indicates whether that square is <em>free</em> (<code>0</code>) or <em>used</em> (<code>1</code>).</p>\\n<p>The hash inputs are a key string (your puzzle input), a dash, and a number from <code>0</code> to <code>127</code> corresponding to the row.  For example, if your key string were <code>flqrgnkx</code>, then the first row would be given by the bits of the knot hash of <code>flqrgnkx-0</code>, the second row from the bits of the knot hash of <code>flqrgnkx-1</code>, and so on until the last row, <code>flqrgnkx-127</code>.</p>\\n<p>The output of a knot hash is traditionally represented by 32 hexadecimal digits; each of these digits correspond to 4 bits, for a total of <code>4 * 32 = 128</code> bits. To convert to bits, turn each hexadecimal digit to its equivalent binary value, high-bit first: <code>0</code> becomes <code>0000</code>, <code>1</code> becomes <code>0001</code>, <code>e</code> becomes <code>1110</code>, <code>f</code> becomes <code>1111</code>, and so on; a hash that begins with <code>a0c2017...</code> in hexadecimal would begin with <code>10100000110000100000000101110000...</code> in binary.</p>\\n<p>Continuing this process, the <em>first 8 rows and columns</em> for key <code>flqrgnkx</code> appear as follows, using <code>#</code> to denote used squares, and <code>.</code> to denote free ones:</p>\\n<pre><code>##.#.#..--&gt;\\n.#.#.#.#   \\n....#.#.   \\n#.#.##.#   \\n.##.#...   \\n##..#..#   \\n.#...#..   \\n##.#.##.--&gt;\\n|      |   \\nV      V   \\n</code></pre>\\n<p>In this example, <code>8108</code> squares are used across the entire 128x128 grid.</p>\\n<p>Given your actual key string, <em>how many squares are used</em>?</p>\\n</article></details>\"}}], :nextjournal/visibility {:code :hide, :result :show}, :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-html, :hash \"5dtFMoRpfSur3BJ5RKN8sHB4mECYMZ\"}, :nextjournal/render-opts {:id \"aoc.2017.14/anon-expr-5drcJ3XtUCrYeDXHYN7uZZRDnLGhgv-result\"}}, :nextjournal/blob-id \"5drHMFw9UQpM5EVdQbzJcjptCA6Ho2\", :nextjournal/fetch-opts {:blob-id \"5drHMFw9UQpM5EVdQbzJcjptCA6Ho2\"}, :nextjournal/hash \"8Vxazw9qFeyB4MMC9hi3LRhVRwYrZiRbDDU1sy1g1vz3YFfr3v7DYjRtihJTockQHK7BRYkB9SeFs3sFKLH9puPG7o\"}, :nextjournal/render-opts {:id \"aoc.2017.14/anon-expr-5drcJ3XtUCrYeDXHYN7uZZRDnLGhgv-result\"}, :nextjournal/visibility {:code :hide, :result :show}, :nextjournal/viewer {:name nextjournal.clerk.viewer/result-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-result, :hash \"5dryaWFamQn5VBuSHLJXGpfgbLUTKh\"}} {:path [], :nextjournal/value [:div.viewer.markdown-viewer.w-full.max-w-prose.px-8 {:data-block-id \"aoc.2017.14/markdown-5dtn8GCqw2urNoSmsQ2X8JrdZtqMfk\"} [\"h1\" {:id \"solution\"} [:<> \"Solution\"]] [:p [:<> \"First things first, let's load our input and parse it\"]]], :nextjournal/render-opts {:id \"aoc.2017.14/markdown-5dtn8GCqw2urNoSmsQ2X8JrdZtqMfk\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/markdown-node-viewer, :render-fn #viewer-fn identity, :hash \"5dsjzwxRkivFXiBf1NDMWmH54cVWV1\"}} {:path [], :nextjournal/value \"(defn parser [data]\\n  (-> data\\n      (str/replace #\\\"\\\\n\\\" \\\"\\\")))\", :nextjournal/render-opts {:loc {:line 26, :end-line 28, :column 1, :end-column 31}, :id \"aoc.2017.14/parser-code\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/code-block-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-code-block, :hash \"5dtogCRMFvgKZ3gMGuwZAef65oxRZD\"}} {:path [], :nextjournal/value {:nextjournal/presented {:path [], :nextjournal/value \"#object[aoc.2017.14$parser 0x4e3d5c98 \\\"aoc.2017.14$parser@4e3d5c98\\\"]\", :nextjournal/viewer {:name nextjournal.clerk.viewer/read+inspect-viewer, :render-fn #viewer-fn (fn [x] (try [nextjournal.clerk.render/inspect (nextjournal.clerk.viewer/read-string-without-tag-table x)] (catch js/Error _e (nextjournal.clerk.render/render-unreadable-edn x)))), :hash \"5du3nEWKL6ov9p2VcYkP5JLW7a9Hwz\"}, :nextjournal/render-opts {:id \"aoc.2017.14/parser-result\"}}, :nextjournal/blob-id nil}, :nextjournal/render-opts {:id \"aoc.2017.14/parser-result\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/result-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-result, :hash \"5dryaWFamQn5VBuSHLJXGpfgbLUTKh\"}} {:path [], :nextjournal/value \"(def input (->> (slurp (io/resource \\\"inputs/2017/14.txt\\\")) ;; Load the resource\\n                parser))                             ;; Split into lines\", :nextjournal/render-opts {:loc {:line 30, :end-line 31, :column 1, :end-column 25}, :id \"aoc.2017.14/input-code\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/code-block-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-code-block, :hash \"5dtogCRMFvgKZ3gMGuwZAef65oxRZD\"}} {:path [], :nextjournal/value {:nextjournal/presented {:path [], :nextjournal/value \"ljoxqyyw\", :nextjournal/viewer {:name nextjournal.clerk.viewer/string-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-quoted-string, :opening-paren \"\\\"\", :closing-paren (\"\\\"\"), :page-size 80, :hash \"5dsoVKnSNgnKXj1Cv4qvD6xr6wMks7\"}, :nextjournal/render-opts {:id \"aoc.2017.14/input-result\"}}, :nextjournal/blob-id \"5dtKCcXri8KyzuKAJDu9oeSpovcARQ\", :nextjournal/fetch-opts {:blob-id \"5dtKCcXri8KyzuKAJDu9oeSpovcARQ\"}, :nextjournal/hash \"8VuVLtdUihfg2m4jJ4PjpUihYCwomoEKRNHcNt3wjSqve8NEhTxK3VqAKVkDyvbPYFbMZAGtJi1K5MWUj6ibW66ham\"}, :nextjournal/render-opts {:id \"aoc.2017.14/input-result\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/result-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-result, :hash \"5dryaWFamQn5VBuSHLJXGpfgbLUTKh\"}} {:path [], :nextjournal/value [:div.viewer.markdown-viewer.w-full.max-w-prose.px-8 {:data-block-id \"aoc.2017.14/markdown-5drgojQ2ThS3FZxp1HuzcXgLajGtdm\"} [:p [:<> \"Example\"]]], :nextjournal/render-opts {:id \"aoc.2017.14/markdown-5drgojQ2ThS3FZxp1HuzcXgLajGtdm\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/markdown-node-viewer, :render-fn #viewer-fn identity, :hash \"5dsjzwxRkivFXiBf1NDMWmH54cVWV1\"}} {:path [], :nextjournal/value \"(def input-example (parser \\\"flqrgnkx\\\"))\", :nextjournal/render-opts {:loc {:line 35, :end-line 35, :column 1, :end-column 40}, :id \"aoc.2017.14/input-example-code\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/code-block-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-code-block, :hash \"5dtogCRMFvgKZ3gMGuwZAef65oxRZD\"}} {:path [], :nextjournal/value \"(defn unhexify [hex]\\n  (apply str\\n         (map\\n          (fn [[x y]] (char (Integer/parseInt (str x y) 16)))\\n          (partition 2 hex))))\", :nextjournal/render-opts {:loc {:line 37, :end-line 41, :column 1, :end-column 31}, :id \"aoc.2017.14/unhexify-code\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/code-block-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-code-block, :hash \"5dtogCRMFvgKZ3gMGuwZAef65oxRZD\"}} {:path [], :nextjournal/value \"(defn knot->binary-numbers [k]\\n  (->> k\\n       char-array\\n       (mapcat #(as-> (-> (str \\\"0x\\\" %)\\n                          read-string\\n                          (Integer/toString 2)\\n                          parse-long) $\\n                  (format \\\"%04d\\\" $)\\n                  (str/split $ #\\\"\\\")\\n                  (map parse-long $)))))\", :nextjournal/render-opts {:loc {:line 43, :end-line 52, :column 1, :end-column 41}, :id \"aoc.2017.14/knot->binary-numbers-code\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/code-block-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-code-block, :hash \"5dtogCRMFvgKZ3gMGuwZAef65oxRZD\"}} {:path [], :nextjournal/value [:div.viewer.markdown-viewer.w-full.max-w-prose.px-8 {:data-block-id \"aoc.2017.14/markdown-5drFf1TXNZLn336Ph1vwbkx8cA6KDv\"} [\"h2\" {:id \"part-1\"} [:<> \"Part 1\"]]], :nextjournal/render-opts {:id \"aoc.2017.14/markdown-5drFf1TXNZLn336Ph1vwbkx8cA6KDv\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/markdown-node-viewer, :render-fn #viewer-fn identity, :hash \"5dsjzwxRkivFXiBf1NDMWmH54cVWV1\"}} {:path [], :nextjournal/value \"(defn part-1\\n  [data]\\n  (->\\n   (->> (range 0 128)\\n        (mapcat (fn [suffix]\\n                  (->>\\n                   (knot-hash-output (str data \\\"-\\\" suffix))\\n                   knot->binary-numbers)))\\n        frequencies)\\n   (get 1)))\", :nextjournal/render-opts {:loc {:line 55, :end-line 64, :column 1, :end-column 13}, :id \"aoc.2017.14/part-1-code\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/code-block-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-code-block, :hash \"5dtogCRMFvgKZ3gMGuwZAef65oxRZD\"}} {:path [], :nextjournal/value [:div.viewer.markdown-viewer.w-full.max-w-prose.px-8 {:data-block-id \"aoc.2017.14/markdown-5dqo1NXgLfjhMgxykGcEprXUno7u6y\"} [\"h2\" {:id \"part-2\"} [:<> \"Part 2\"]]], :nextjournal/render-opts {:id \"aoc.2017.14/markdown-5dqo1NXgLfjhMgxykGcEprXUno7u6y\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/markdown-node-viewer, :render-fn #viewer-fn identity, :hash \"5dsjzwxRkivFXiBf1NDMWmH54cVWV1\"}} {:path [], :nextjournal/value \"(defn part-2\\n  [data]\\n  (let [m           (->> (range 0 128)\\n                         (map (fn [suffix]\\n                                (->>\\n                                 (knot-hash-output (str data \\\"-\\\" suffix))\\n                                 knot->binary-numbers))))\\n        valid-cells (->> (pf/decode-matrix m)\\n                         :cells\\n                         (filter (fn [[_ n]]\\n                                   (= n 1)))\\n                         (map (fn [[coords]]\\n                                coords)))\\n        edges       (mapcat (fn [coords]\\n                              (let [[y x]     coords\\n                                    neighbors (filter #(some #{%} valid-cells)\\n                                                      [[(dec y) x] [(inc y) x] [y (dec x)] [y (inc x)]])]\\n                                (map #(vector coords %) neighbors))) valid-cells)\\n        g           (-> (uber/graph)\\n                        (uber/add-nodes* valid-cells)\\n                        (uber/add-undirected-edges* edges))]\\n    (->\\n     (alg/connected-components g)\\n     count)))\", :nextjournal/render-opts {:loc {:line 69, :end-line 92, :column 1, :end-column 14}, :id \"aoc.2017.14/part-2-code\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/code-block-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-code-block, :hash \"5dtogCRMFvgKZ3gMGuwZAef65oxRZD\"}} {:path [], :nextjournal/value [:div.viewer.markdown-viewer.w-full.max-w-prose.px-8 {:data-block-id \"aoc.2017.14/markdown-5dtDWouhgRcvd3akFfTpyZfsmDVeUm\"} [\"h1\" {:id \"tests\"} [:<> \"Tests\"]]], :nextjournal/render-opts {:id \"aoc.2017.14/markdown-5dtDWouhgRcvd3akFfTpyZfsmDVeUm\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/markdown-node-viewer, :render-fn #viewer-fn identity, :hash \"5dsjzwxRkivFXiBf1NDMWmH54cVWV1\"}} {:path [], :nextjournal/value \"(deftest test-2017-14\\n  (testing \\\"part one\\\"\\n    (is (= 8316 (part-1 input))))\\n\\n  (testing \\\"part two\\\"\\n    (is (= 1074 (part-2 input)))))\", :nextjournal/render-opts {:loc {:line 97, :end-line 102, :column 1, :end-column 35}, :id \"aoc.2017.14/test-2017-14-code\"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/code-block-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-code-block, :hash \"5dtogCRMFvgKZ3gMGuwZAef65oxRZD\"}} {:path [], :nextjournal/value {:nextjournal/presented {:path [], :nextjournal/value [:div.grid.grid-cols-3.gap-10 ([:div {:class \"flex flex-col gap-4 p-6 items-center text-black font-semibold bg-green-200\"} [:span.capitalize.text-lg.text-black \"pass\"] [:span.text-xl.font-bold 2]] [:div {:class \"flex flex-col gap-4 p-6 items-center text-black font-semibold bg-orange-200 opacity-25\"} [:span.capitalize.text-lg.text-black \"fail\"] [:span.text-xl.font-bold 0]] [:div {:class \"flex flex-col gap-4 p-6 items-center text-black font-semibold bg-red-200 opacity-25\"} [:span.capitalize.text-lg.text-black \"error\"] [:span.text-xl.font-bold 0]])], :nextjournal/visibility {:code :hide, :result :show}, :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-html, :hash \"5dtFMoRpfSur3BJ5RKN8sHB4mECYMZ\"}, :nextjournal/render-opts {:id \"aoc.2017.14/anon-expr-5drt1oA8jvqBUN7Ln9hGgsKMvQZ6Z6-result\"}}, :nextjournal/blob-id \"5drifQPVqbSC5dmjvhJhxXqF58jiAb\", :nextjournal/fetch-opts {:blob-id \"5drifQPVqbSC5dmjvhJhxXqF58jiAb\"}, :nextjournal/hash \"8Vvwa5AaUhPp1fsZdeWQ7TKm1jCZ3FGj9Q6TzuihQ4cC6fCrzzfMMbmf7koBpcnFMWmNW1GrvLL1WbBQHSQbjKayNF\"}, :nextjournal/render-opts {:id \"aoc.2017.14/anon-expr-5drt1oA8jvqBUN7Ln9hGgsKMvQZ6Z6-result\"}, :nextjournal/visibility {:code :hide, :result :show}, :nextjournal/viewer {:name nextjournal.clerk.viewer/result-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-result, :hash \"5dryaWFamQn5VBuSHLJXGpfgbLUTKh\"}}]}, :nextjournal/viewer {:name nextjournal.clerk.viewer/notebook-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-notebook, :hash \"5dsiHybTyGGTEpReRaV7nfNxoDgnKx\"}}}, :current-path \"src/aoc/2017/14\", :resource->url {\"/js/viewer.js\" \"https://storage.clerk.garden/nextjournal/clerk-assets@43sknWSpfsWGp1HAfZe1dLuBjmWH/viewer.js?immutable=true\", \"/css/viewer.css\" \"_data/8VwC6fDMy6vk5cFDRApNww7gzg5ZkHPof25FWfy2Xk5sXLC7Y5hcdUv8KhPr3oxgq3LKb4mNZWdWc4JtsXLkwHnmg1.css\"}, :index \"src/index.clj\"}".replaceAll('nextjournal.clerk.view/escape-closing-script-tag', 'script')
viewer.init(viewer.read_string(state))
</script></body></html>